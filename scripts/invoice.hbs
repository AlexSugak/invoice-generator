<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Invoice {{invoiceNumber}}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* --------- Base layout --------- */
    :root {
      --fg: #111827;
      --muted: #6b7280;
      --line: #e5e7eb;
      --accent: #065f46;
      --bg: #ffffff;
    }
    html, body {
      background: var(--bg);
      color: var(--fg);
      font: 12px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      box-sizing: border-box;
      padding: 14mm;
    }
    .grid {
      display: grid;
      gap: 10px;
    }
    .grid-2 {
      grid-template-columns: 1fr 1fr;
    }
    .grid-3 {
      grid-template-columns: repeat(3, 1fr);
    }
    h1, h2, h3 {
      margin: 0;
      line-height: 1.2;
    }
    .muted { color: var(--muted); }
    .tag {
      display: inline-block;
      font-weight: 600;
      padding: 2px 6px;
      border: 1px solid var(--line);
      border-radius: 4px;
    }
    .box {
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 10px;
    }
    .mb-2 { margin-bottom: 8px; }
    .mb-3 { margin-bottom: 12px; }
    .mb-4 { margin-bottom: 16px; }
    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .mt-4 { margin-top: 16px; }
    .right { text-align: right; }
    .bold { font-weight: 700; }
    .small { font-size: 11px; }

    /* --------- Table --------- */
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      vertical-align: top;
      border-top: 1px solid var(--line);
    }
    thead th {
      text-align: left;
      font-weight: 700;
      border-top: none;
      border-bottom: 1.5px solid var(--line);
    }
    tbody tr { page-break-inside: avoid; }

    /* --------- Totals --------- */
    .totals {
      width: 100%;
    }
    .totals td {
      padding: 6px 8px;
    }
    .totals .row { border-top: 1px solid var(--line); }
    .totals .grand {
      border-top: 1.5px solid var(--line);
      font-weight: 700;
      font-size: 13px;
    }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #065f46;
      border: 1px solid #a7f3d0;
      font-weight: 600;
    }

    /* --------- Print --------- */
    @page {
      size: A4;
      margin: 12mm;
    }
    @media print {
      .page { padding: 0; width: auto; min-height: auto; }
      .no-print { display: none !important; }
      a { color: inherit; text-decoration: none; }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Header -->
    <div class="grid grid-2 mb-4">
      <div>
        {{#if logoUrl}}
          <img src="{{logoUrl}}" alt="Logo" style="max-height:60px; max-width:220px;" />
        {{/if}}
        <h1 class="mt-3">INVOICE</h1>
        <div class="mt-2">
          <span class="tag"># {{invoiceNumber}}</span>
        </div>
      </div>

      <div class="right">
        <div class="bold">{{from.name}}</div>
        {{#if from.line1}}{{from.line1}}<br/>{{/if}}
        {{#if from.line2}}{{from.line2}}<br/>{{/if}}
        {{#if from.city}}{{from.city}}{{#if from.state}}, {{from.state}}{{/if}} {{from.zip}}<br/>{{/if}}
        {{#if from.country}}{{from.country}}<br/>{{/if}}
        {{#if from.email}}<span class="muted">{{from.email}}</span><br/>{{/if}}
        {{#if from.phone}}<span class="muted">{{from.phone}}</span>{{/if}}
      </div>
    </div>

    <!-- Meta -->
    <div class="grid grid-3 mb-3">
      <div class="box">
        <div class="muted small">Invoice Date</div>
        <div class="bold">{{formatDate date}}</div>
      </div>
      <div class="box">
        <div class="muted small">Payment Terms</div>
        <div class="bold">{{paymentTerms}}</div>
      </div>
      <div class="box">
        <div class="muted small">Due Date</div>
        <div class="bold">{{formatDate dueDate}}</div>
      </div>
    </div>

    <!-- Addresses -->
    <div class="grid grid-2 mb-4">
      <div class="box">
        <h3>Bill To</h3>
        <div class="mt-2">
          <div class="bold">{{billTo.name}}</div>
          {{#if billTo.line1}}{{billTo.line1}}<br/>{{/if}}
          {{#if billTo.line2}}{{billTo.line2}}<br/>{{/if}}
          {{#if billTo.city}}{{billTo.city}}{{#if billTo.state}}, {{billTo.state}}{{/if}} {{billTo.zip}}<br/>{{/if}}
          {{#if billTo.country}}{{billTo.country}}<br/>{{/if}}
          {{#if billTo.email}}<span class="muted">{{billTo.email}}</span><br/>{{/if}}
          {{#if billTo.phone}}<span class="muted">{{billTo.phone}}</span>{{/if}}
        </div>
      </div>

      <div class="box">
        <h3>Ship To</h3>
        <div class="mt-2">
          <div class="bold">{{shipTo.name}}</div>
          {{#if shipTo.line1}}{{shipTo.line1}}<br/>{{/if}}
          {{#if shipTo.line2}}{{shipTo.line2}}<br/>{{/if}}
          {{#if shipTo.city}}{{shipTo.city}}{{#if shipTo.state}}, {{shipTo.state}}{{/if}} {{shipTo.zip}}<br/>{{/if}}
          {{#if shipTo.country}}{{shipTo.country}}<br/>{{/if}}
          {{#if shipTo.email}}<span class="muted">{{shipTo.email}}</span><br/>{{/if}}
          {{#if shipTo.phone}}<span class="muted">{{shipTo.phone}}</span>{{/if}}
        </div>
      </div>
    </div>

    <!-- Items -->
    <table>
      <thead>
        <tr>
          <th style="width:50%;">Description</th>
          <th class="right" style="width:10%;">Qty</th>
          <th class="right" style="width:20%;">Rate</th>
          <th class="right" style="width:20%;">Amount</th>
        </tr>
      </thead>
      <tbody>
        {{#each items}}
          <tr>
            <td>
              {{#if description}}{{description}}{{else}}&mdash;{{/if}}
            </td>
            <td class="right">{{quantity}}</td>
            <td class="right">{{currency ../currency rate}}</td>
            <td class="right">{{currency ../currency (times quantity rate)}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>

    <!-- Totals -->
    <div class="grid grid-2 mt-4">
      <div>
        {{#if notes}}
          <div class="mb-3">
            <div class="bold">Notes</div>
            <div class="small">{{notes}}</div>
          </div>
        {{/if}}
        {{#if terms}}
          <div>
            <div class="bold">Terms</div>
            <div class="small">{{terms}}</div>
          </div>
        {{/if}}
      </div>

      <div>
        <table class="totals">
          <tbody>
            <tr class="row">
              <td class="right muted">Subtotal</td>
              <td class="right bold">{{currency currency (subtotal items)}}</td>
            </tr>
            <tr class="row">
              <td class="right muted">Tax ({{taxPercent}}%)</td>
              <td class="right bold">{{currency currency (tax (subtotal items) taxPercent)}}</td>
            </tr>
            {{#if discount}}
              <tr class="row">
                <td class="right muted">Discount</td>
                <td class="right bold">- {{currency currency discount}}</td>
              </tr>
            {{/if}}
            {{#if shipping}}
              <tr class="row">
                <td class="right muted">Shipping</td>
                <td class="right bold">{{currency currency shipping}}</td>
              </tr>
            {{/if}}
            <tr class="grand">
              <td class="right">Total</td>
              <td class="right">{{currency currency (total (subtotal items) taxPercent discount shipping)}}</td>
            </tr>
            {{#if amountPaid}}
              <tr class="row">
                <td class="right muted">Amount Paid</td>
                <td class="right bold">- {{currency currency amountPaid}}</td>
              </tr>
              <tr class="grand">
                <td class="right">Balance Due</td>
                <td class="right">
                  {{currency currency (balance (total (subtotal items) taxPercent discount shipping) amountPaid)}}
                </td>
              </tr>
            {{/if}}
          </tbody>
        </table>
        {{#if amountPaid}}
          <div class="right mt-2"><span class="pill">BALANCE DUE</span></div>
        {{else}}
          <div class="right mt-2"><span class="pill">AMOUNT DUE</span></div>
        {{/if}}
      </div>
    </div>

    <!-- Optional payment link / QR -->
    {{#if paymentLink}}
      <div class="mt-4 small">
        Pay online: <a href="{{paymentLink}}">{{paymentLink}}</a>
      </div>
    {{/if}}
  </div>
</body>
</html>